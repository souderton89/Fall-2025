#!/bin/bash

# Simple Enhanced Port Scanner
# Original script enhanced with basic error checking and CSV output
# Contributors: [Add your team member names here]

# Basic parameter check
if [ $# -ne 2 ]; then
    echo "Usage: $0 <hostfile> <portfile>"
    exit 1
fi

hostfile=$1
portfile=$2

# Check if files exist
if [ ! -f "$hostfile" ]; then
    echo "Error: Host file '$hostfile' not found"
    exit 1
fi

if [ ! -f "$portfile" ]; then
    echo "Error: Port file '$portfile' not found"
    exit 1
fi

# CSV header
echo "host,port,status"

# Main scanning loop - same structure as original
for host in $(cat $hostfile); do
    for port in $(cat $portfile); do
        # Skip empty lines
        [ -z "$host" ] && continue
        [ -z "$port" ] && continue
        
        # Original scanning method with timeout
        if timeout 2 bash -c "echo >/dev/tcp/$host/$port" 2>/dev/null; then
            echo "$host,$port,open"
        else
            echo "$host,$port,closed"
        fi
    done
done
